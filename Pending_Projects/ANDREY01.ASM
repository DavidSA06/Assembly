;RECEPTOR DE INFORMACION RX 
LIST P=16F877A
INCLUDE <P16F877A.INC>
__CONFIG _CP_OFF & _WDT_OFF & _PWRTE_ON & _XT_OSC & _LVP_OFF & _BODEN_OFF

ANS1					EQU					20H								;INICIALIZACION DE VARIABLES
CONSTANTE				EQU					21H
CONSTANTE2				EQU					22H
VALORL					EQU					23H

RESET					ORG					00H								;VECTOR DE RESET
						GOTO				INICIO
						ORG 08H


INICIO					BSF					STATUS,RP0						;VECTOR DE INICIO
;						BCF					STATUS,RP1						;BANCO 1
						
						MOVLW 	B'00000001'
						MOVWF 	TRISA
						MOVLW	B'00000000'
						MOVLW	TRISB



						MOVLW				B'10000000'
						MOVWF				TRISC
						MOVLW				D'25'							;9600  BAUDIOS
						;MOVLW				D'12'							;19200 BAUDIOS
						MOVWF				SPBRG							;BAUDIOS Fosc/(K*(X+1)) X=SPBRG
						BCF					TXSTA,TX9						;TRANSMISION A 8 BITS
						BCF					TXSTA,SYNC						;USART MODO ASINCRONO 
						BSF					TXSTA,BRGH						;BAUDIOS RATE HIGH SPEED K=16
						BSF					TXSTA,TXEN						;TRANSMISION HABILITADA
						MOVLW				B'11000111'
						MOVWF				OPTION_REG						;PORTB PULL-UP HABILITADO (SOLO PARA PROGRAMAR)
						BCF					STATUS,RP0
						BCF					STATUS,RP1						;BANCO 0
						CLRF				INTCON							;INTERRUPCIONES DESHABILITADOS
						BSF					RCSTA,SPEN						;PUERTO SERIAL HABILITADO
						BCF					RCSTA,RX9						;RECEPCION A 8 BITS
						BSF					RCSTA,CREN						;RECEPCION CONTINUA


					MOVLW B'01000001'	;TOSC*32,CANAL 0,CONVERSION NO ACTIVA,CONVERSOR ENCENDIDO
					MOVWF ADCON0
					BSF STATUS, RP0
					MOVLW B'10000001'	;ADRESL, PINES A/A/A/A, 6 BITS VACIOS EN ADRESH
					MOVWF ADCON1
					BCF STATUS,RP0

;RCN						BTFSS				PIR1,RCIF						;BANDERA DE RECEPCION ?
;						GOTO				RCN
;						BTFSS				PIR1,RCIF
;						GOTO				RCN
;						MOVF				RCREG,W
;						MOVWF				ANS1
;						BCF					PIR1,RCIF

;						INCF				ANS1,F							;INCREMENTA LA VARIABLE RECIBIDA Y ENVIALA DE NUEVO


;;;;;;;;;;;;;;;;;;;CONVERSOR ANALOGICO-DIGITAL

CICLO				BSF ADCON0,ADON		;ACTIVAR EL MODULO DE CONVERSION
					NOP					
					NOP
					NOP
					NOP
					BSF ADCON0,GO_DONE	;CONVERSION EN CURSO
ESPERA				BTFSC ADCON0,GO_DONE;ESPERAR AL FINAL DE LA CONVERSION
					GOTO ESPERA
					BCF ADCON0,ADON		;DESACTIVAR EL MODULO DE CONVERSION	
					BCF PIR1,ADIF		;BAJAR LA BANDERA DE CONVERSION

					BSF STATUS,RP0		;CAMBIO AL BANCO 1
					MOVFW ADRESL		;OBTENER LOS 8 BITS MENOS SIGNIFICATIVOS
					MOVWF VALORL
					BCF STATUS,RP0		;CAMBIO AL BANCO 0
					MOVFW VALORL
					MOVWF PORTB



;						MOVFW	VALORL
;						MOVF				ANS1,W
;						MOVWF				TXREG
;TXN1					BTFSS				PIR1,TXIF						;BANDERA DE TRANSMISION ?
;						GOTO				TXN1
;						BTFSS				PIR1,TXIF
;						GOTO				TXN1
;						BCF					PIR1,TXIF
;						CLRF				TXREG
					
					
;						INCF				ANS1,F

;						MOVFW	ADRESH
;						MOVF				ANS1,W
;						MOVWF				TXREG
;TXN2					BTFSS				PIR1,TXIF						;BANDERA DE TRANSMISION ?
;						GOTO				TXN2
;						BTFSS				PIR1,TXIF
;						GOTO				TXN2
;						BCF					PIR1,TXIF
;						CLRF				TXREG
;						CLRF				ANS1
;						GOTO				RCN
						GOTO CICLO
		
END
										